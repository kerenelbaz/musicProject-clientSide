<!DOCTYPE HTML>
<html>
<head>
	<title>KILYRICS</title>
	<link rel="icon" type="image/png" href="./images/icon.ico"/>
	<meta charset="utf-8" />
	<link rel="icon" type="image/png" href="./images/iconKIL.png"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="assets/css/main.css" />
	<!-- Scripts -->
	<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
	<script src="./scripts/ajaxCalls.js"></script>
	<script src="./scripts/apies.js"></script>
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/jquery.dropotron.min.js"></script>
	<script src="assets/js/jquery.scrolly.min.js"></script>
	<script src="assets/js/jquery.scrollex.min.js"></script>
	<script src="assets/js/browser.min.js"></script>
	<script src="assets/js/breakpoints.min.js"></script>
	<script src="assets/js/util.js"></script>
	<script src="assets/js/main.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.css" />
  
	<script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.js"></script>
	<style>
		#container {
			height: 100%;
			text-align: center;
			display: flex;
			flex-wrap: wrap;
			justify-content: center;
			align-items: center;
		}

		#pForm{
			width :100%;
			justify-content: center;
			align-items: center;
			
			display: none;
		}

		#card {
			height: 650px;
			width: 400px;
			margin: 1%;
			background-color: white;
			font-family: Candara;
			border: 3px solid rgb(230, 221, 221);
			border-radius: 10px;
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			text-align: center;
		}

		#card img {
			height: 220px;
			width: 100%;
			border-radius: 7px;
		}

		h4 {
			margin: 1px;
		}

		p {
			margin: 1px;
			text-align: left;
		}

		#lyrics , #Bio {
			margin: 10px;
			float: left;
			height: 300px;
			overflow-y: scroll;
		}

		#lyrics::-webkit-scrollbar-track, #Bio::-webkit-scrollbar-track,
		body::-webkit-scrollbar-track {
			-webkit-box-shadow: inset 0 0 6px rgba(114, 59, 114, 0.24);
			border-radius: 10px;
			background-color: #F5F5F5;
		}

		#lyrics::-webkit-scrollbar, #Bio::-webkit-scrollbar,
		body::-webkit-scrollbar {
			width: 12px;
			background-color: #f1efef;
		}

		#lyrics::-webkit-scrollbar-thumb, #Bio::-webkit-scrollbar-thumb,
		body::-webkit-scrollbar-thumb {
			border-radius: 10px;
			-webkit-box-shadow: inset 0 0 6px rgba(56, 47, 47, 0.295);
			background-color: #655068c5;
		}



		#card button {
			margin-top: 20px;
			background-color: hsla(285, 33%, 26%, 0.808);
			color: rgb(179, 169, 169);
			border: 1px solid rgb(242, 233, 243);
			/* border: none; */
			border-radius: 50px;
			font-size: 15px;
			
		}

	
		#card button:hover .fa-star {
			color: rgb(236, 248, 7);
		}

		#searchBTN{
			margin: 0 0 0.5em 0.5em;
		}
		
		#quizDiv{
			width: 30%;
			height: 30%;
			background-color: whitesmoke;
			/* background-color: #212529; */
		}


		#radioContainer {
			direction: ltr;
		}

		input[type="radio"] {
			appearance: none;
			-webkit-appearance: none;
			-moz-appearance: none;
			width: 16px;
			height: 16px;
			border: 2px solid #212529;
			border-radius: 50%;
			float: left;
			margin-right: 10px;
		}

		

		input[type="radio"]:checked {
			/* Add a background color to create the dot effect when the radio button is checked */
			background-color: #212529;
			/* You can change the size and position of the dot here */
			background-size: 8px 8px;
			background-position: center;
			background-repeat: no-repeat;
		}

		label {
			padding-left: 17%;
			float: left;
			margin-left: -14%;
			display: inline-block;
			vertical-align: top;
			direction: ltr;
		}


		
	</style>
</head>
<body class="left-sidebar is-preload" onload="HomeRender()">
	<div id="page-wrapper">
		<!-- Header -->
		<div id="header">
			<!-- Inner -->
			<div class="inner">
				<header>
					<img src="./images/KILYRICS_LOGO1.png" alt="alternate_text">
					<h1 id="whichPage"></h1>
					<div id="helloUserName"></div>
				</header>
			</div>
			<!-- Nav -->
			<nav id="nav"><!--nevigate menu-->
				<ul>
					<li onclick="HomeRender()"><a href="#">Home</a></li>
					<li onclick="renderFavorites(JSON.parse(localStorage['onlineUser']).userId)"><a href="#">Your Favorites</a></li>
					<li onclick="renderAtrists()"><a href="#">Artists</a></li>					
					<li>
						<a href="#">Search Music</a>
						<ul>
							<li onclick="renderSearching(1)"><a href="#">By Name Of Song</a></li>
							<li onclick="renderSearching(2)"><a href="#">By Artist</a></li>
							<li onclick="renderSearching(3)"><a href="#">By Lyrics</a></li>
						</ul>
					</li>
					<li onclick="quiz()"><a href="#">hidon??</a></li>
					<li onclick="logOut()"><a href="#">Log Out</a></li>
				</ul>
			</nav>
		</div>
		<form id="pForm">
			<table id ="example"> 
				<thead>
					<tr>
						<td></td>
						<td>User Id</td>
						<td>Name</td>
						<td>Country</td>
						<td>Email</td>
						<td>Password</td>
						<td>Phone Number</td>
						<td>Registered At</td>
					</tr>
				</thead>			
			</table>
		</form>
		<div id="container"></div>
	</div>

	<script>
		if (localStorage['onlineUser'] != null) {
			let loginDiv = document.createElement("div");
			loginDiv.id = "loggedIn";
			loginDiv.innerHTML = `<span>Hello ${JSON.parse(localStorage['onlineUser']).name}!</span>`;
			document.getElementById("helloUserName").appendChild(loginDiv);
		}
		if(JSON.parse(localStorage['onlineUser']).email == 'admin@gmail.com'){
			const usersLi = document.createElement("li");
    		usersLi.innerHTML = '<a href="#">Users</a>';
			usersLi.addEventListener("click", function(){
				renderUsersTable()
			})
    		document.getElementById("nav").getElementsByTagName("ul")[0].appendChild(usersLi);
		}
	</script>

	
	<script>

		let userID = JSON.parse(localStorage['onlineUser']).userId;
		let favoriteSongsOfUserArr = {}; //this array will be used in 'GetFavoriteSongsOfUser' function that do the ajaxCall and read all the favorites songs.
		GetFavoriteSongsOfUser(JSON.parse(userID));


		function HomeRender() {
			
			whichPage = document.getElementById("whichPage");
			whichPage.innerHTML = "HOME";
			GetFavoriteSongsOfUser(JSON.parse(userID));
			document.getElementById("pForm").style.display = "none"
			const api = `${port}/api/Song`;
			ajaxCall("GET", api, "", successCB, errorCB);
		}

		function successCB(data) {
			localStorage.setItem("songsData", JSON.stringify(data));
			if (data)
				renderSongs(data);
			else
				alert("Something went wrong");
		}


		function renderSongs(songsArr) {
			let container = document.getElementById("container");
			container.innerHTML = "";

			for (var i = 0; i <songsArr.length; i++) {
				let card = document.createElement("div");
				card.id = "card";
				container.appendChild(card);

				let img = document.createElement("img");
				// img.id = "appartmentIMG";
				img.src = "./images/pic01.jpg";
				card.appendChild(img);

				let artist = document.createElement("h4");
				artist.innerHTML = "Artist: " + songsArr[i].artist;
				card.appendChild(artist);

				let nameOfSong = document.createElement("h4");
				nameOfSong.innerHTML = "Name: " + songsArr[i].songName;
				card.appendChild(nameOfSong);
				
				if(JSON.parse(localStorage['onlineUser']).email == "admin@gmail.com"){
					let numOfLikes = document.createElement("h4");
					numOfLikes.innerHTML = songsArr[i].songInFavorite +" Users like this song"
					card.appendChild(numOfLikes);
				}
				

				let lyrics = document.createElement("p");
				lyrics.id = "lyrics";
				lyrics.innerHTML = "Lyrics: <br/>" + songsArr[i].lyrics;
				card.appendChild(lyrics);

				let addOrRemoveSongBTN = document.createElement("button");
				addOrRemoveSongBTN.id = songsArr[i].songId;
				addOrRemoveSongBTN.innerHTML = "<i class='fa-solid fa-star'></i>"; //the star is font of the btn

				for (var j = 0 ; j<favoriteSongsOfUserArr.length ; j++){ //checking if the favorite song is in the array in order to mark it as favorite
					if(favoriteSongsOfUserArr[j].songId == songsArr[i].songId){
						addOrRemoveSongBTN.style.color='rgb(236, 248, 7)'; //change the font color in order to mark the song as favorite
					}
				}

				addOrRemoveSongBTN.onclick = function () {
					if (this.style.color=='rgb(236, 248, 7)'){
						this.style.color='rgb(179, 169, 169)';
						removeSongFromFav(this.id);
					}
					else{
						this.style.color='rgb(236, 248, 7)';
						addToFavorite(this.id);
					}
				};
				card.appendChild(addOrRemoveSongBTN);
			}
		}
	




		function logOut() {
			swal("Are you sure you want to log out?", {
				buttons: ["No", "Yes"],
			}).then((value) => {
				if (value) {
					window.location.href = "welcomePage.html";
				}
			});
		}

		function renderFavorites(userId) {
			let whichPage = document.getElementById("whichPage");
			whichPage.innerHTML = "YOUR FAVORITES";
			document.getElementById("pForm").style.display = "none"
			GetFavoriteSongsOfUser(userId);

			
			
		}

		function renderUsersTable(){
			let whichPage = document.getElementById("whichPage");
			whichPage.innerHTML = "USERS VIEW";
			document.getElementById("container").innerHTML = ""
			document.getElementById("pForm").style.display = "flex"
			ajaxCall("GET", "https://localhost:7070/api/User", "", getSuccess, error);
		}

		// wire all the buttons to their functions
        function buttonEvents() {
			$(document).on("click", ".viewBtn", function () {
				markSelected(this);
				GetFavoriteSongsOfUser(this.getAttribute('data-userid'))
				
			});
		}

		// mark the selected row
        function markSelected(btn) {
            $("#example tr").removeClass("selected"); // remove seleced class from rows that were selected before
            row = (btn.parentNode).parentNode; // button is in TD which is in Row
            row.className = 'selected'; // mark as selected
        }

		function getSuccess(usersdata) {
            users = usersdata; // keep the cars array in a global variable;
            try{
                tbl = $('#example').DataTable({
                    data: usersdata,
					retrieve: true,  				
                    pageLength: 5,
                    columns: [
                        {
                            render: function (data, type, row, meta) {
                                let dataUser = "data-userId='" + row.userId + "'";                             
                                viewBtn = "<button type='button' class = 'viewBtn btn btn-info' " + dataUser + "> View </button>";
                                
                                return  viewBtn;
                            }
                        },
                        { data: "userId" },
                        { data: "name" },
                        { data: "country" },
                        { data: "email" },
                        { data: "password" },
                        { data: "phoneNumber" },
                        { data: "registrationTime" }                                              
                    ],
                });
                buttonEvents();
            }

            catch (err) {
                alert(err);
            }
        }

        // this function is activated in case of a failure
        function error(err) {
            swal("Error: " + err );
        }

		function GetFavoriteSongsOfUser(userId){
			const api = `${port}/api/User/GetFavoriteSongsOfUser?userId=${userId}`;
			ajaxCall("GET", api, "", successCB_getFavoriteSongsOfUser, errorCB);
		}

		function renderSongsFromTable(songsArr) {
			let container = document.getElementById("container");
			container.innerHTML = "";

			for (var i = 0; i <songsArr.length; i++) {
				let card = document.createElement("div");
				card.id = "card";
				container.appendChild(card);

				let img = document.createElement("img");
				// img.id = "appartmentIMG";
				img.src = "./images/pic01.jpg";
				card.appendChild(img);

				let artist = document.createElement("h4");
				artist.innerHTML = "Artist: " + songsArr[i].artist;
				card.appendChild(artist);

				let nameOfSong = document.createElement("h4");
				nameOfSong.innerHTML = "Name: " + songsArr[i].songName;
				card.appendChild(nameOfSong);
				
				if(JSON.parse(localStorage['onlineUser']).email == "admin@gmail.com"){
					let numOfLikes = document.createElement("h4");
					numOfLikes.innerHTML = songsArr[i].songInFavorite +" Users like this song"
					card.appendChild(numOfLikes);
				}
				

				let lyrics = document.createElement("p");
				lyrics.id = "lyrics";
				lyrics.innerHTML = "Lyrics: <br/>" + songsArr[i].lyrics;
				card.appendChild(lyrics);
			}
		}
		
		function successCB_getFavoriteSongsOfUser(data) {
			if (data){
				favoriteSongsOfUserArr = data;
				let whichPage = document.getElementById("whichPage");
				if (whichPage.innerHTML == "YOUR FAVORITES"){
					renderSongs(favoriteSongsOfUserArr);
				}
				if(whichPage.innerHTML == "USERS VIEW"){
					renderSongsFromTable(favoriteSongsOfUserArr)
				}
					
				
				
			}

			else
				alert("Something went wrong");
		}


		
		function addToFavorite(songId) {
			if (localStorage['onlineUser'] != null) {
				let userId = JSON.parse(localStorage['onlineUser']).userId;
				const api = `${port}/api/User/insertSongToFavorites?songId=${songId}&userId=${userId}`;
				ajaxCall("POST", api, "", successCBaddToFav, errorCB);
			}
		}

		function successCBaddToFav(data) {
			if (data) {
				alert("Song added to your favorites");

			}

			if (data == false) {
				alert("This song is already in your favorites");
			}
		}



		function removeSongFromFav(songId){
			const api = `${port}/api/User/deleteSongFromFavorites?songId=${songId}&userId=${JSON.parse(localStorage['onlineUser']).userId}`;
            ajaxCall("DELETE", api, "", successCBDeleteFromFav, errorCB);

		}

        function successCBDeleteFromFav(data) {
            alert("song deleted");
            favoriteSongsOfUserArr = data;
			
        }

		function errorCB(data) {
			if (data == false) {
				alert("Error");
			}
		}



		function renderSearching(number) {
			let container = document.getElementById("container");
			container.innerHTML = "";
			const whichPage = document.getElementById("whichPage");
			whichPage.innerHTML = "SEARCH MUSIC BY ";

			const searchDiv = document.createElement('div');
			searchDiv.style.display = 'flex';
			searchDiv.id = "searchDiv";

			const textBox = document.createElement('input');
			textBox.id = 'searchBox';
			textBox.type = 'text';
			searchDiv.appendChild(textBox);

			switch (number) {
				case 1:
					whichPage.innerHTML += "NAME";
					textBox.placeholder = 'Enter a name of a song';
					break;
				case 2:
					whichPage.innerHTML += "ARTIST";
					textBox.placeholder = 'Enter an artist name';
					break;
				case 3:
					whichPage.innerHTML += "LYRICS";
					textBox.placeholder = 'Enter lyrics from the song';
					break;
				default:
					console.log("Unknown!");
			}

			const searchBTN = document.createElement('button');
			searchBTN.style.margin = "0 0 0.5em 0.5em";
			searchBTN.innerHTML = 'Search';
			searchBTN.onclick = function() {
				const input = document.getElementById("searchBox").value;
				if (input !== "") {
					switch (number) {
						case 1:
						getSongsByName(input);
						break;
						case 2:
						getSongsByArtist(input);
						break;
						case 3:
						getSongsByLyrics(input);
						break;
						default:
						console.log("Unknown!");
					}
				} else {
					switch (number) {
						case 1:
						alert("Enter the name of a song");
						break;
						case 2:
						alert("Enter the name of an artist");
						break;
						case 3:
						alert("Enter the lyrics");
						break;
						default:
						console.log("Unknown!");
					}
				}
			};

			

			searchDiv.appendChild(searchBTN);
			whichPage.appendChild(searchDiv);
		}

		function searchSongs(api) {
			ajaxCall("GET", api, "", successCB, errorCB);
		}

		function getSongsByName(songName) {
			const api = `${port}/api/Song/bySongName?songName=${songName}`;
			searchSongs(api);
		}

		function getSongsByArtist(artist) {
			const api = `${port}/api/Song/byArtistName?artistName=${artist}`;
			searchSongs(api);
		}

		function getSongsByLyrics(lyrics) {
			const api = `${port}/api/Song/bySongLyrics?lyrics=${lyrics}`;
			searchSongs(api);
		}

		let currrntSongID;
		function quiz()
		{
			document.getElementById("pForm").style.display = "none"
			const songsData =  JSON.parse(localStorage.getItem("songsData"));
			

			//all 3 are a dictionary maps type 
			const songsMap={};
			const lyricsMap = {};
			const artistsMap = {};
			const allArrays=[songsMap,lyricsMap,artistsMap];

			
			function createDS()
			{
				
				for(var item of songsData)
				{
					// Create dictionary maps for lyrics and artist arrays
					const songID = item.songId;
					
					const songName = item.songName;
					songsMap[songID] = songName;

					const artistName = item.artist;
					artistsMap[songID] = artistName;

					const lyrics = item.lyrics;
					lyricsMap[songID] = lyrics;
					
				}
				allArrays.push(songsMap, artistsMap, lyricsMap);

				// Iterate through each key-value pair in the lyricsMap and truncate the values
				for (const key in lyricsMap) {
					if (lyricsMap.hasOwnProperty(key)) {
						lyricsMap[key] = truncateToWords(lyricsMap[key], 10);
					}
				}
			}
			
			createDS();
			//חותכת את מילות השיר למספר מילים שנותנים לפונקציה
			function truncateToWords(str, numWords) 
			{
				const words = str.split(" ");
				stringToReturn = words.slice(0, numWords).join(" ");
				stringToReturn = removeAfterLineBreak(stringToReturn)
				return stringToReturn;
			}
			//מורידה רווחים ואת ה\r\
			function removeAfterLineBreak(sentence) {
				const index = sentence.indexOf("\r\n");
				if (index !== -1) {
					sentence = sentence.substring(0, index);
				}
				return sentence.trimEnd(); //remove whitespace
			}
			

			

			createQuastion();

			function createQuastion()
			{
				let container = document.getElementById("container");
				container.innerHTML = "";
				const whichPage = document.getElementById("whichPage");
				whichPage.innerHTML = "Let's play!";

				let currentQuestion=1; 

				const quizDiv = document.createElement("div");
				quizDiv.id = "quizDiv";
				container.appendChild(quizDiv);

				const optionDiv = document.createElement("div");
				optionDiv.id = "optionDiv";
				quizDiv.appendChild(optionDiv);
				
				const questionBtn = document.createElement("BUTTON");
				questionBtn.id = "questionBtn";
				questionBtn.textContent = "Next question";
				
				questionBtn.addEventListener("click", function () {
					quizDiv.innerHTML = "";
					currentQuestion += 1;
					showCurrentSong(currentQuestion);
				});
				
				showCurrentSong(currentQuestion);
				// console.log("current question: "+currentQuestion);
				function showCurrentSong(currentQuestion) {
					quizDiv.innerHTML = "";
					const songNum = document.createElement("h3");
					songNum.id="songNum";
					songNum.innerHTML = "Song Number: " + currentQuestion;

					const queStr = document.createElement("h3");
					queStr.id = "queStr"; 
					queStr.innerHTML = renderQuestion();


					quizDiv.appendChild(songNum);
					quizDiv.appendChild(queStr);
					quizDiv.appendChild(optionDiv);
					quizDiv.appendChild(questionBtn);
					
				}

					function renderQuestion()
					{
						const questionDict={
							A : 'which artist wrote the song #?',
							B : 'what is the name of the song that its lyrics are: \n# ?', 
							C : 'who wrote the song that goes like that # ?', 
							D : 'fill the correct word',
							E : 'what song did # wrote ?'
						};
 

						//random select which question (A B C or D) selected
						//const keyQue = getRandomQuestion(questionDict);
						const keyQue = 'A';
						let returnedArray=[];
						switch (keyQue) {
							case 'A':
								returnedArray = GetTheCompleteSentence(songsMap, questionDict[keyQue]);
								console.log("2 song id came from the function: "+returnedArray[0]);
								radioContainer = createArtistsOption(returnedArray[0]);
								// console.log(radioContainer);	
								optionDiv.innerHTML = "";
								optionDiv.appendChild(radioContainer);
							 	//console.log(returnedArray);
								return returnedArray[2]; 
							break;
							case 'B':
								returnedArray = GetTheCompleteSentence(lyricsMap, questionDict[keyQue]);
								// console.log(returnedArray);
								console.log("2 song id came from the function: "+returnedArray[0]);
								return returnedArray[2]; 
								
								break;
							case 'C':
							
								console.log("nothing");
								
								break;

							case 'D':
								console.log("nothing");
								break;
							case 'E':
								returnedArray = GetTheCompleteSentence(artistsMap, questionDict[keyQue]);
								return returnedArray[2]; 
							default:
						console.log("default!");

						}
						
					}

					function getRandomQuestion(obj) { // get a random question by key
						const keys = Object.keys(obj);
						const randomIndex = Math.floor(Math.random() * keys.length);
						// console.log(keys[randomIndex]);
						return keys[randomIndex]; 
					}

					function GetTheCompleteSentence(arr, question) {
						let tmpArr=[];

						const songIDs = Object.keys(arr); // מערך של מפתחות 
						const randomIndex = Math.floor(Math.random() * songIDs.length);// מגריל אינדקס
						
						const randomSongID = songIDs[randomIndex];
						const randomSongName = songsMap[randomSongID];
						
						
						// let currrntSongID;
						// let arrayFromFunc = getRandomItem(arr);
						// let songName = arrayFromFunc[0];

						//to get the random songID of the random songName
						// for(const key in arr)
						// {
						// 	if(arr.hasOwnProperty(key) && arr[key]===songName)
						// 	currrntSongID = key;
						// }
						

						const completeQuestion = question.replace('#', randomSongName);
						console.log("1 in the function - currrntSongID: "+randomSongID); 
						tmpArr.push(randomSongID);
						tmpArr.push(randomSongName);
						tmpArr.push(completeQuestion);
						return tmpArr;
					}
					
					function pickAndInsertRandomStrings(setOfStrings, givenString) {
						// Make a copy of the setOfStrings array to avoid modifying the original array
						const remainingStrings = [...setOfStrings];

						// Remove the givenString from the remainingStrings array (if it exists)
						const indexToRemove = remainingStrings.indexOf(givenString);
						if (indexToRemove !== -1) {
							remainingStrings.splice(indexToRemove, 1);
						}

						// Pick 3 random strings from the remainingStrings array
						const pickedStrings = [];
						for (let i = 0; i < 3; i++) {
							const randomIndex = Math.floor(Math.random() * remainingStrings.length);
							const randomString = remainingStrings.splice(randomIndex, 1)[0];
							pickedStrings.push(randomString);
						}

						// Insert the givenString randomly into the pickedStrings array
						const randomInsertIndex = Math.floor(Math.random() * 4);
						pickedStrings.splice(randomInsertIndex, 0, givenString);

						return pickedStrings;
					}
					
					function createArtistsOption(songID)
					{
						let quizDiv = document.getElementById("quizDiv");
						//מוצאים את השם של הזמר
						let correctAnswer = artistsMap[songID] 
						const artistNames = Object.values(artistsMap);
						const uniqueArtistArray = [...new Set(artistNames)]; //unique the array above
						let possibleAnswer = pickAndInsertRandomStrings(uniqueArtistArray, correctAnswer);
						
						// console.log("poosible answer: " + possibleAnswer);
						// console.log("correct answer: "+  correctAnswer);
						
						const radioContainer = document.createElement("div");
						radioContainer.innerHTML = "";
						radioContainer.id = "radioContainer";

						for (let i = 0; i < possibleAnswer.length; i++) {
							const radioLabel = document.createElement("label");
							radioLabel.setAttribute("for", "radioOption" + i);
							radioLabel.textContent = possibleAnswer[i];

							const radioButton = document.createElement("input");
							radioButton.type = "radio";
							radioButton.id = "radioOption" + i;
							radioButton.name = "radioOptions";
							radioButton.value = i;

							radioContainer.appendChild(radioButton);
							radioContainer.appendChild(radioLabel);
							radioContainer.appendChild(document.createElement("br"));
						}

							return radioContainer;
					}
		
					// function getRandomItem(obj) //gets songsMap/artissMap/lyricsMap
					// {
					// 	let tmpToReturn = [];
					// 	//Retrieve all the song IDs (keys) from the object (songMap/artistMap/lyricsMap)
					// 	const songIDs = Object.keys(obj); // מערך של מפתחות 
					// 	const randomIndex = Math.floor(Math.random() * songIDs.length);// מגריל אינדקס
						
					// 	const randomSongID = songIDs[randomIndex];
					// 	const randomSongName = songsMap[randomSongID];
						
						
					// 	tmpToReturn.push(randomSongName);
					// 	tmpToReturn.push(randomSongID);
					// 	return tmpToReturn;
					// }

					
					
				showCurrentSong();				
				// questionBtn.addEventListener("click", function () {
				// 	quizDiv.innerHTML = "";
				// 	currentQuestion = (currentQuestion + 1) % songsMap.length;
				// 	showCurrentSong();
				// 	console.log(currentQuestion);
				// });

			}	
		}

		
		
		// async function getArtistInfo(artistName) {
		// 	const url = 'https://genius-song-lyrics1.p.rapidapi.com/artist/details/?id=344497';
		// 	const options = {
		// 		method: 'GET',
		// 		headers: {
		// 			'X-RapidAPI-Key': '8ca6442259mshfdaecd0aeabaeabp195d39jsnd1943a2b84b2',
		// 			'X-RapidAPI-Host': 'genius-song-lyrics1.p.rapidapi.com'
		// 		}
		// 	};

		// 	try {
		// 		const response = await fetch(url, options);
		// 		const result = await response.text();
		// 		console.log(result);
		// 	} catch (error) {
		// 		console.error(error);
		// 	}


		// }



		function getArtistInfo(artistName) {
			$.ajax({
				url: 'http://ws.audioscrobbler.com/2.0/',
				method: 'GET',
				data: {
					method: 'artist.getinfo',
					artist: artistName,
					api_key: 'd213eba8760d06561048ca7e571dcce2', //this is the API of lastFM website
					format: 'json'
				},
				success: function(response) {
					 console.log(response);
					// let container = document.getElementById("container");

					// let card = document.createElement("div");
					// card.id = "card";
					// container.appendChild(card);

					// let img = document.createElement("img");
					// img.src = response.artist.image[4];
					// card.appendChild(img);

					// let artist = document.createElement("h4");
					// artist.innerHTML = response.artist.name;
					// card.appendChild(artist);
					
					if(JSON.parse(localStorage['onlineUser']).email == "admin@gmail.com"){
						ajaxCall("GET", `${port}/api/Artist/inFavoriteCount?artistName=${response.artist.name}`, "",
						function(number){	
							let numOfFavorites = document.createElement("h4");
							numOfFavorites.innerHTML = `Apears ${number} times in favorites`;
							card.appendChild(numOfFavorites);
						} , errorCB);
					}
					
					// let bio = document.createElement("p");
					// bio.id = "Bio";
					// bio.innerHTML = "Bio: <br/>" + response.artist.bio.content;
					// card.appendChild(bio);

				
				},
				error: function(error) {
					// Handle the error
					console.error(error);
				}
			});
		}

		function renderAtrists(){
			whichPage = document.getElementById("whichPage");
			whichPage.innerHTML = "ARTISTS";
			document.getElementById("pForm").style.display = "none"
			const api =  `${port}/api/Artist/GetAllArtists`;			
			ajaxCall("GET", api, "", successCB_renderAtrists , errorCB);

		}

		function successCB_renderAtrists(data){			
			if(data){

				let container = document.getElementById("container");
				container.innerHTML = "";
				// Loop through the array and call the function for each artist
				for (let i = 0; i < data.length; i++) {
					const artistName = data[i];
					getArtistInfo(artistName);
				}
			}
			else alert("something wrong");
		}



		getArtistImage('abba');


		async function getArtistImage(artistName) {
			
			const clientId = "76eb58574dca4292942f6b50535fe9b9";
			const clientSecret = "df624510f02e46a39a9f04d250b1cde8";

			const auth = btoa(`${clientId}:${clientSecret}`);
			const tokenResponse = await fetch('https://accounts.spotify.com/api/token', {
				method: 'POST',
				headers: {
				'Content-Type': 'application/x-www-form-urlencoded',
				'Authorization': `Basic ${auth}`
				},
				body: 'grant_type=client_credentials'
			});

			const { access_token } = await tokenResponse.json();



			const searchResponse = await fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(artistName)}&type=artist`, {
				method: 'GET',
				headers: {
				'Authorization': `Bearer ${access_token}`
				}
			});

			const { artists } = await searchResponse.json();
			if (!artists || !artists.items || artists.items.length === 0) {
				console.error('Artist not found or no image available.');
				return;
			}

			const artistId = artists.items[0].id;

			const artistDetailsResponse = await fetch(`https://api.spotify.com/v1/artists/${artistId}`, {
				method: 'GET',
				headers: {
				'Authorization': `Bearer ${access_token}`
				}
			});

			const artistDetails = await artistDetailsResponse.json();
			if (!artistDetails || !artistDetails.images || artistDetails.images.length === 0) {
				console.error('Artist not found or no image available.');
				return;
			}

			// Assuming you want the first image, you can customize this to use a different size if needed.
			const imageUrl = artistDetails.images[0].url;
			console.log(artistDetails);

			console.log('Image URL:', imageUrl);
    	}









	</script>
</body>
</html>
