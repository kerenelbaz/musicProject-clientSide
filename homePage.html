<!DOCTYPE HTML>
<html>
<head>
	<title>KILYRICS</title>
	<meta charset="utf-8" />
	<link rel="icon" type="image/png" href="./images/iconKIL.png"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="assets/css/main.css" />
	<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
	<script src="./scripts/ajaxCalls.js"></script>
	<script src="./scripts/apies.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<style>
		#container {
			height: 100%;
			text-align: center;
			display: flex;
			flex-wrap: wrap;
			justify-content: center;
			align-items: center;
		}

		#card {
			height: 650px;
			width: 400px;
			margin: 1%;
			background-color: white;
			font-family: Candara;
			border: 3px solid rgb(230, 221, 221);
			border-radius: 10px;
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			text-align: center;
		}

		#card img {
			height: 220px;
			width: 100%;
			border-radius: 7px;
		}

		h4 {
			margin: 1px;
		}

		p {
			margin: 1px;
			text-align: left;
		}

		#lyrics {
			margin: 10px;
			float: left;
			height: 300px;
			overflow-y: scroll;
		}

		#lyrics::-webkit-scrollbar-track,
		body::-webkit-scrollbar-track {
			-webkit-box-shadow: inset 0 0 6px rgba(114, 59, 114, 0.24);
			border-radius: 10px;
			background-color: #F5F5F5;
		}

		#lyrics::-webkit-scrollbar,
		body::-webkit-scrollbar {
			width: 12px;
			background-color: #f1efef;
		}

		#lyrics::-webkit-scrollbar-thumb,
		body::-webkit-scrollbar-thumb {
			border-radius: 10px;
			-webkit-box-shadow: inset 0 0 6px rgba(56, 47, 47, 0.295);
			background-color: #655068c5;
		}



		#card button {
			margin-top: 20px;
			background-color: hsla(285, 33%, 26%, 0.808);
			color: rgb(179, 169, 169);
			border: 1px solid rgb(242, 233, 243);
			/* border: none; */
			border-radius: 50px;
			font-size: 15px;
			
		}

	
		#card button:hover .fa-star {
			color: rgb(236, 248, 7);
		}

		#searchBTN{
			margin: 0 0 0.5em 0.5em;
		}
	


		
	</style>
</head>
<body class="left-sidebar is-preload" onload="HomeRender()">
	<div id="page-wrapper">
		<!-- Header -->
		<div id="header">
			<!-- Inner -->
			<div class="inner">
				<header>
					<img src="./images/KILYRICS_LOGO1.png" alt="alternate_text">


					<!-- <h1><a href="homePage.html" id="logo">KILYRICS</a></h1> -->
					<h1 id="whichPage"></h1>
					<div id="helloUserName"></div>
				</header>
			</div>
			<!-- Nav -->
			<nav id="nav"><!--nevigate menu-->
				<ul>
					<li onclick="HomeRender()"><a href="#">Home</a></li>
					<li onclick="renderFavorites(JSON.parse(localStorage['onlineUser']).userId)"><a href="#">Your Favorites</a></li>
					<li><a href="#">Artists</a></li>
					<li>
						<a href="#">Search Music</a>
						<ul>
							<li onclick="renderSearching(1)"><a href="#">By Name Of Song</a></li>
							<li onclick="renderSearching(2)"><a href="#">By Artist</a></li>
							<li onclick="renderSearching(3)"><a href="#">By Lyrics</a></li>
						</ul>
					</li>
					<li><a href="#">hidon??</a></li>
					<li onclick="logOut()"><a href="#">Log Out</a></li>
				</ul>
			</nav>
		</div>
		<div id="container"></div>
	</div>

	<script>
		if (localStorage['onlineUser'] != null) {
			let loginDiv = document.createElement("div");
			loginDiv.id = "loggedIn";
			loginDiv.innerHTML = `<span>Hello ${JSON.parse(localStorage['onlineUser']).name}!</span>`;
			document.getElementById("helloUserName").appendChild(loginDiv);
		}
	</script>

	<!-- Scripts -->
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/jquery.dropotron.min.js"></script>
	<script src="assets/js/jquery.scrolly.min.js"></script>
	<script src="assets/js/jquery.scrollex.min.js"></script>
	<script src="assets/js/browser.min.js"></script>
	<script src="assets/js/breakpoints.min.js"></script>
	<script src="assets/js/util.js"></script>
	<script src="assets/js/main.js"></script>
	<script>

		let userID = JSON.parse(localStorage['onlineUser']).userId;
		let favoriteSongsOfUserArr = {}; //this array will be used in 'GetFavoriteSongsOfUser' function that do the ajaxCall and read all the favorites songs.
		GetFavoriteSongsOfUser(JSON.parse(userID));


		function HomeRender() {
			
			whichPage = document.getElementById("whichPage");
			whichPage.innerHTML = "HOME";
			GetFavoriteSongsOfUser(JSON.parse(userID));
			const api = `${port}/api/Song`;
			ajaxCall("GET", api, "", successCB, errorCB);
		}

		function successCB(data) {
			localStorage.setItem("songsData", JSON.stringify(data));
			if (data)
				renderSongs(data);
			else
				alert("Something went wrong");
		}


		function renderSongs(songsArr) {
			let container = document.getElementById("container");
			container.innerHTML = "";

			for (var i = 0; i <songsArr.length; i++) {
				let card = document.createElement("div");
				card.id = "card";
				container.appendChild(card);

				let img = document.createElement("img");
				// img.id = "appartmentIMG";
				img.src = "./images/pic01.jpg";
				card.appendChild(img);

				let artist = document.createElement("h4");
				artist.innerHTML = "Artist: " + songsArr[i].artist;
				card.appendChild(artist);

				let nameOfSong = document.createElement("h4");
				nameOfSong.innerHTML = "Name: " + songsArr[i].songName;
				card.appendChild(nameOfSong);
				
				if(JSON.parse(localStorage['onlineUser']).email == "admin@gmail.com"){
					let numOfLikes = document.createElement("h4");
					numOfLikes.innerHTML = songsArr[i].songInFavorite +" Users like this song"
					card.appendChild(numOfLikes);
				}
				

				let lyrics = document.createElement("p");
				lyrics.id = "lyrics";
				lyrics.innerHTML = "Lyrics: <br/>" + songsArr[i].lyrics;
				card.appendChild(lyrics);

				let addOrRemoveSongBTN = document.createElement("button");
				addOrRemoveSongBTN.id = songsArr[i].songId;
				addOrRemoveSongBTN.innerHTML = "<i class='fa-solid fa-star'></i>"; //the star is font of the btn

				for (var j = 0 ; j<favoriteSongsOfUserArr.length ; j++){ //checking if the favorite song is in the array in order to mark it as favorite
					if(favoriteSongsOfUserArr[j].songId == songsArr[i].songId){
						addOrRemoveSongBTN.style.color='rgb(236, 248, 7)'; //change the font color in order to mark the song as favorite
					}
				}

				addOrRemoveSongBTN.onclick = function () {
					if (this.style.color=='rgb(236, 248, 7)'){
						this.style.color='rgb(179, 169, 169)';
						removeSongFromFav(this.id);
					}
					else{
						this.style.color='rgb(236, 248, 7)';
						addToFavorite(this.id);
					}
				};
				card.appendChild(addOrRemoveSongBTN);
			}
		}
	




		function logOut() {
			swal("Are you sure you want to log out?", {
				buttons: ["No", "Yes"],
			}).then((value) => {
				if (value) {
					window.location.href = "welcomePage.html";
				}
			});
		}

		function renderFavorites(userId) {
			let whichPage = document.getElementById("whichPage");
			whichPage.innerHTML = "YOUR FAVORITES";
			GetFavoriteSongsOfUser(userId);
			//renderSongs(favoriteSongsOfUserArr);
			
			
		}



		function GetFavoriteSongsOfUser(userId){
			const api = `${port}/api/User/GetFavoriteSongsOfUser?userId=${userId}`;
			ajaxCall("GET", api, "", successCB_getFavoriteSongsOfUser, errorCB);
		}
		
		function successCB_getFavoriteSongsOfUser(data) {
			if (data){
				favoriteSongsOfUserArr = data;
				let whichPage = document.getElementById("whichPage");
				if (whichPage.innerHTML == "YOUR FAVORITES" ){
					renderSongs(favoriteSongsOfUserArr);
					// if(favoriteSongsOfUserArr.length == 0)
					// {
					// 	alert("You don't have favorite songs yet");
					// }
				}
				
			}

			else
				alert("Something went wrong");
		}


		
		function addToFavorite(songId) {
			if (localStorage['onlineUser'] != null) {
				let userId = JSON.parse(localStorage['onlineUser']).userId;
				const api = `${port}/api/User/insertSongToFavorites?songId=${songId}&userId=${userId}`;
				ajaxCall("POST", api, "", successCBaddToFav, errorCB);
			}
		}

		function successCBaddToFav(data) {
			if (data) {
				alert("Song added to your favorites");

			}

			if (data == false) {
				alert("This song is already in your favorites");
			}
		}



		function removeSongFromFav(songId){
			const api = `${port}/api/User/deleteSongFromFavorites?songId=${songId}&userId=${JSON.parse(localStorage['onlineUser']).userId}`;
            ajaxCall("DELETE", api, "", successCBDeleteFromFav, errorCB);

		}

        function successCBDeleteFromFav(data) {
            alert("song deleted");
            favoriteSongsOfUserArr = data;
			
        }

		function errorCB(data) {
			if (data == false) {
				alert("Error");
			}
		}



		function renderSearching(number) {
			let container = document.getElementById("container");
			container.innerHTML = "";
			const whichPage = document.getElementById("whichPage");
			whichPage.innerHTML = "SEARCH MUSIC BY ";

			const searchDiv = document.createElement('div');
			searchDiv.style.display = 'flex';
			searchDiv.id = "searchDiv";

			const textBox = document.createElement('input');
			textBox.id = 'searchBox';
			textBox.type = 'text';
			searchDiv.appendChild(textBox);

			switch (number) {
				case 1:
					whichPage.innerHTML += "NAME";
					textBox.placeholder = 'Enter a name of a song';
					break;
				case 2:
					whichPage.innerHTML += "ARTIST";
					textBox.placeholder = 'Enter an artist name';
					break;
				case 3:
					whichPage.innerHTML += "LYRICS";
					textBox.placeholder = 'Enter lyrics from the song';
					break;
				default:
					console.log("Unknown!");
			}

			const searchBTN = document.createElement('button');
			searchBTN.style.margin = "0 0 0.5em 0.5em";
			searchBTN.innerHTML = 'Search';
			searchBTN.onclick = function() {
				const input = document.getElementById("searchBox").value;
				if (input !== "") {
					switch (number) {
						case 1:
						getSongsByName(input);
						break;
						case 2:
						getSongsByArtist(input);
						break;
						case 3:
						getSongsByLyrics(input);
						break;
						default:
						console.log("Unknown!");
					}
				} else {
					switch (number) {
						case 1:
						alert("Enter the name of a song");
						break;
						case 2:
						alert("Enter the name of an artist");
						break;
						case 3:
						alert("Enter the lyrics");
						break;
						default:
						console.log("Unknown!");
					}
				}
			};

			

			searchDiv.appendChild(searchBTN);
			whichPage.appendChild(searchDiv);
		}

		function searchSongs(api) {
			ajaxCall("GET", api, "", successCB, errorCB);
		}

		function getSongsByName(songName) {
			const api = `${port}/api/Song/bySongName?songName=${songName}`;
			searchSongs(api);
		}

		function getSongsByArtist(artist) {
			const api = `${port}/api/Song/byArtistName?artistName=${artist}`;
			searchSongs(api);
		}

		function getSongsByLyrics(lyrics) {
			const api = `${port}/api/Song/bySongLyrics?lyrics=${lyrics}`;
			searchSongs(api);
		}

		function quiz()
		{
			const songsDataString = localStorage.getItem("songsData");
			if (songsDataString !== null) {
 			 	// "songsData" exists, parse the JSON string
  				const t = JSON.parse(songsDataString);
  				console.log(t);
			} else {
  				console.log("No data found in localStorage for 'songsData'.");
			}
			// const songsName = localStorage.getItem("userData").
			// const lyricsFromSong = 
			// const artistFromSong = 
		}


	</script>
</body>
</html>
